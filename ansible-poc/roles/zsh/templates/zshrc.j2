### Added by Zinit's installer
if [[ ! -f $HOME/.local/share/zinit/zinit.git/zinit.zsh ]]; then
    print -P "%F{33} %F{220}Installing %F{33}ZDHARMA-CONTINUUM%F{220} Initiative Plugin Manager (%F{33}zdharma-continuum/zinit%F{220})â€¦%f"
    command mkdir -p "$HOME/.local/share/zinit" && command chmod g-rwX "$HOME/.local/share/zinit"
    command git clone https://github.com/zdharma-continuum/zinit "$HOME/.local/share/zinit/zinit.git" && \
        print -P "%F{33} %F{34}Installation successful.%f%b" || \
        print -P "%F{160} The clone has failed.%f%b"
fi

source "$HOME/.local/share/zinit/zinit.git/zinit.zsh"
autoload -Uz _zinit
(( ${+_comps} )) && _comps[zinit]=_zinit
### End of Zinit's installer chunk

# Generated by Ansible for {{ ansible_hostname }}
# User: {{ ansible_env.USER }}
# OS: {{ ansible_os_family }}
{% if is_work_machine %}# Work machine configuration{% endif %}

# Environment Setup
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8
export EDITOR=$(command -v nvim >/dev/null && echo "nvim" || echo "vim")
[[ $EDITOR == "nvim" ]] && alias vim="nvim"
command -v codium &> /dev/null && alias code="codium"

# PATH is managed in .zshenv

# Set LS_COLORS for file type coloring
if command -v vivid &> /dev/null; then
    export LS_COLORS="$(vivid generate catppuccin-mocha)"
fi

# Load Custom Aliases
source ~/.config/zsh/aliases

# Allow aliases to work with sudo
alias sudo='sudo '

# Vi mode
bindkey -v
export KEYTIMEOUT=1  # Fast mode switching (10ms)

# Keybindings (set after vi mode to override defaults)
bindkey '^p' history-search-backward
bindkey '^n' history-search-forward
bindkey '^\[w' kill-region

# History Configuration
HISTSIZE=50000
HISTFILE=~/.zsh_history
SAVEHIST=$HISTSIZE
HISTDUP=erase
setopt appendhistory
setopt sharehistory
setopt extended_history
setopt hist_ignore_space
setopt hist_ignore_all_dups
setopt hist_ignore_dups
setopt hist_save_no_dups
setopt hist_find_no_dups
setopt hist_reduce_blanks
setopt hist_verify
setopt auto_cd

# Completion styling
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Za-z}'
zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"
zstyle ':completion:*' menu no

# Load Custom Host Configurations
[[ -f "$HOME/.config/zsh/hosts" ]] && source "$HOME/.config/zsh/hosts" && alias hosts="cat $HOME/.config/zsh/hosts"

# ZSH Plugins
zinit light-mode for \
    atinit"zicompinit; zicdreplay" \
        zdharma-continuum/fast-syntax-highlighting

zinit wait lucid light-mode for \
    atload"_zsh_autosuggest_start" \
        zsh-users/zsh-autosuggestions \
    blockf atpull'zinit creinstall -q .' \
        zsh-users/zsh-completions

# Platform-specific configurations
{% if ansible_os_family == "Darwin" %}
[[ -f "$HOME/.config/zsh/profile-macos" ]] && source "$HOME/.config/zsh/profile-macos"
{% else %}
[[ -f "$HOME/.config/zsh/profile-linux" ]] && source "$HOME/.config/zsh/profile-linux"
{% endif %}

{% if is_work_machine %}
# Work-specific configurations
[[ -f "$HOME/.config/zsh/profile-work" ]] && source "$HOME/.config/zsh/profile-work"
{% endif %}

# fzf
if command -v fzf &> /dev/null; then
    if ! eval "$(fzf --zsh 2>/dev/null)"; then
        echo "Warning: Failed to initialize fzf" >&2
    else
        # Catppuccin Mocha theme for fzf
        export FZF_DEFAULT_OPTS="--height=80% \
--color=bg+:#313244,bg:#1e1e2e,spinner:#f5e0dc,hl:#f38ba8 \
--color=fg:#cdd6f4,header:#f38ba8,info:#cba6f7,pointer:#f5e0dc \
--color=marker:#f5e0dc,fg+:#cdd6f4,prompt:#cba6f7,hl+:#f38ba8"
    fi
fi

# zoxide - smarter cd
if command -v zoxide &> /dev/null; then
    eval "$(zoxide init zsh)"
fi

# Starship prompt
if command -v starship &> /dev/null; then
    eval "$(starship init zsh)"
fi

{% if ansible_os_family == "Darwin" %}
# Auto-start tmux on macOS (skip in SSH/mosh/vscode)
if command -v tmux &> /dev/null && [ -z "$TMUX" ] && [ -z "$SSH_CONNECTION" ] && [ -z "$MOSH_CONNECTION" ] && [ "$TERM_PROGRAM" != "vscode" ] && [ "$TERM_PROGRAM" != "Cursor" ]; then
    exec tmux new-session -A -s main
fi
{% endif %}
